<h1>
  Outils demande de congés
</h1>
<div>
  <div><strong>Solde CP année N: </strong>{{currentUser.cpN}}</div>
  <div><strong>Solde CP année N-1: </strong>{{currentUser.cpNMoins1}}</div>
  <div><strong>Solde RTT: </strong>{{currentUser.rttn}}</div>
</div>
<br>
<div style="display: flex; justify-content: center; align-items: center">
  <mat-progress-spinner
    *ngIf="FicheEnvoyee != null"
    color="accent"
    mode="indeterminate">
  </mat-progress-spinner>
</div>
<mat-tab-group [selectedIndex]="dateNow.getMonth()">
  <mat-tab *ngFor="let mois of nomsDesMois"  [disabled]="disableTabs(nomsDesMois.indexOf(mois))" >

    <ng-template mat-tab-label>
     <span [matTooltip]="disableTabs(nomsDesMois.indexOf(mois))?'Ce mois est déjà passé':''">{{mois}} {{dateNow.getFullYear()}}</span>
    </ng-template>
    <ng-template matTabContent>
    <div style="justify-content: space-evenly;display: flex">
      <!--  <div style="border: 1px solid;width: 75vw;height: 60vh; text-align: left;" >
          <div style="border: 1px solid;width: 10vw;height: 2em; display: inline-block; text-align: center;vertical-align: center;" *ngFor="let d of joursDeLaSemaine">{{d}}</div>
          <div style="border:0px solid;height: 10vh;width: 10vw;display: inline-block;" *ngFor="let i of creatArray(addCells())"></div>
          <div (mousedown)="addRemoveDay(day);mouseDown = true" (mouseup)="mouseDown = false" (mouseleave)="mouseDown? addRemoveDay(day):''" *ngFor="let day of getDaysInMonth(dateNow.getMonth(),dateNow.getFullYear())" style="border:2px solid;height: 10vh;width: 10vw;display: inline-block;position: relative;" [ngStyle]="{'background-color':checkDay(day)?'orange':checkWeekends(day)?'grey':''}">
            <span style="position: absolute;top:0.5em;right: 0.5em;font-size: 2em" >{{day | date:'d'}}</span>
          </div>
        </div>-->
      <div id="cont">
        <div style="border: none;width: 38vw;height: 32vh; text-align: left;" id="calendrier">
          <h1 style="text-align: center">{{mois}} {{dateNow.getFullYear()}}</h1>
          <div style="border: 1px solid;width: 5vw;height: 2em; display: inline-block; text-align: center;vertical-align: center;" *ngFor="let d of joursDeLaSemaine">{{d}}</div>
          <div style="border:0px solid;height: 5vh;width: 5vw;display: inline-block;" *ngFor="let i of creatArray(addCells(nomsDesMois.indexOf(mois)))"></div>
          <div (mousedown)="addRemoveDay(day);mouseDown = true" (mouseup)="mouseDown = false" (mouseleave)="mouseDown? addRemoveDay(day):''" *ngFor="let day of getDaysInMonth(nomsDesMois.indexOf(mois),dateNow.getFullYear())"
               style="border:2px solid;height: 5vh;width: 5vw;display: inline-block;position: relative;" [ngStyle]="{'background-color':getDayColor(day)}">
            <span style="position: absolute;top:0.5em;right: 0.5em;font-size: 1em" >{{day | date:'d'}}</span>
            <span style="position: absolute;top:2em;right: 0.5em;font-size: 0.8em">{{f.value[toMomentFormat(day)+' boolean']?'1/2':''}} {{absShort[absences.indexOf(f.value[toMomentFormat(day)])]}}</span>
          </div>
        </div>
        <br>
        <div *ngIf="FicheEnvoyee">
        </div>
      </div>

      <!--  <mat-card class="calendar-card">
        <mat-card-title>
          {{dateNow.getFullYear()}}
        </mat-card-title>
      &lt;!&ndash;  <mat-month-view [dateFilter]="dateFilter" [activeDate]="dateNow" #calendar (selectedChange)="addRemoveDay($event)" (selected)="SelectCell($event)">&ndash;&gt;
      &lt;!&ndash;  </mat-month-view>&ndash;&gt;
      </mat-card>-->

      <div style="width: 40vw">
        <h4>
          Jours de congés demandés
        </h4>
        <div>
          <form (ngSubmit)="sendRequest(f)" #f="ngForm">
            <div *ngIf="mesCongesObj.length == 0; else conges" class="emptyDaysoff">Pas de jours de congés demandés ce mois-ci</div>
            <ng-template #conges>
              <ul>
                <li *ngFor="let c of mesCongesObj">{{c.date}} - {{c.typeConge}} {{c.demiJournee?'demi-journée':''}}</li>
              </ul>
            </ng-template>
            <div *ngFor="let dayOff of daysOffObj" style="margin: 1em;box-shadow:  0 0 20px #D3D3D3;padding: 2em;">
              <mat-form-field>
                <span class="prefix" matPrefix>{{dayOff.date}}</span>
                <mat-select #raison [(ngModel)]="dayOff.typeConge" [name]="dayOff.date" required placeholder="Type d'absence" (selectionChange)="decreaseCount($event.value, dayOff.date);autoFillType($event.value,dayOff.date)">
                  <mat-option *ngFor="let absence of absences" [value]="absence">
                    <span matPrefix *ngIf="absence ==='Congés payés'" style="font-weight: bolder;border: solid" [ngStyle]="{'color':currentUser.cpN>0?'darkblue':'red'}">{{currentUser.cpN}}</span>
                    <span matPrefix *ngIf="absence ==='RTT'" style="font-weight: bolder;border: solid" [ngStyle]="{'color':currentUser.cpN>0?'darkblue':'red'}">{{(currentUser.rttn)}}</span> {{absence}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-checkbox [(ngModel)]="dayOff.demiJournee" [name]="dayOff.date + ' boolean'">Demi-journée?</mat-checkbox>
              <br>
              <mat-form-field class="commentaires">
                <input matInput placeholder="Commentaires {{(raison.value && raison.value !== 'Absences exceptionnelle'?'facultatif':'')}}" [(ngModel)]="dayOff.commentaires" [name]="dayOff.date + ' comm'" [required]="raison.value === 'Absences exceptionnelle'">
              </mat-form-field>
            </div>
            <button mat-raised-button type="submit" [disabled]="f.invalid">Envoyer</button>
          </form>
          <!--  <p>{{f.value | json }}</p>-->
        </div>
      </div>
<!--
      <pre>{{s(daysOffObj)}}</pre>
-->
    </div>
    </ng-template>
  </mat-tab>
</mat-tab-group>

<!--<div *ngIf="FicheEnvoyee" id="final">-->
<!--  Vous avez envoyée votre Fiche de présence pour ce mois-ci-->
<!--</div>-->
